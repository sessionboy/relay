<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>GraphQL in Relay · Relay</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;Table of Contents:&lt;/p&gt;
"/><meta name="docsearch:version" content="v2.0.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="GraphQL in Relay · Relay"/><meta property="og:type" content="website"/><meta property="og:url" content="https://facebook.github.io/relay/index.html"/><meta property="og:description" content="&lt;p&gt;Table of Contents:&lt;/p&gt;
"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/relay/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/relay/css/main.css"/><script src="/relay/js/codetabs.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/relay/en"><img class="logo" src="/relay/img/relay-white.svg" alt="Relay"/><h2 class="headerTitleWithLogo">Relay</h2></a><a href="/relay/en/versions.html"><h3>v2.0.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/relay/docs/en/introduction-to-relay.html" target="_self">Docs</a></li><li class=""><a href="/relay/en/help.html" target="_self">Support</a></li><li class=""><a href="https://github.com/facebook/relay" target="_self">GitHub</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>API Reference</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Introduction</h3><ul class=""><li class="navListItem"><a class="navItem" href="/relay/docs/en/introduction-to-relay.html">Introduction to Relay</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/prerequisites.html">Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/installation-and-setup.html">Installation and Setup</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/quick-start-guide.html">Quick Start Guide</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API Reference</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/relay/docs/en/graphql-in-relay.html">GraphQL in Relay</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/relay-environment.html">Relay Environment</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/network-layer.html">Network Layer</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/query-renderer.html">&lt;QueryRenderer /&gt;</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/fragment-container.html">Fragment Container</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/refetch-container.html">Refetch Container</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/pagination-container.html">Pagination Container</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/mutations.html">Mutations</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/subscriptions.html">Subscriptions</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/relay-store.html">Relay Store</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/fetch-query.html">fetchQuery</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/relay/docs/en/routing.html">Routing</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/relay-debugging.html">Debugging</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/graphql-server-specification.html">GraphQL Server Specification</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/persisted-queries.html">Persisted Queries</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Migration Guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/relay/docs/en/new-in-relay-modern.html">New in Relay Modern</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/relay-compat.html">Compatibility Mode</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/migration-setup.html">Migration Setup</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/conversion-playbook.html">Conversion Playbook</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/conversion-scripts.html">Conversion Scripts</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/upgrading-setvariables.html">Upgrading setVariables</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/converting-mutations.html">Converting Mutations</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/compatibility-cheatsheet.html">Compatibility Cheatsheet</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/api-cheatsheet.html">API Cheatsheet</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Principles &amp; Architecture</h3><ul class=""><li class="navListItem"><a class="navItem" href="/relay/docs/en/thinking-in-graphql.html">Thinking in GraphQL</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/thinking-in-relay.html">Thinking In Relay</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/architecture-overview.html">Architecture Overview</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/compiler-architecture.html">Compiler Architecture</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/runtime-architecture.html">Runtime Architecture</a></li><li class="navListItem"><a class="navItem" href="/relay/docs/en/videos.html">Videos</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Community</h3><ul class=""><li class="navListItem"><a class="navItem" href="/relay/docs/en/community-learning-resources.html">Community Learning Resources</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/facebook/relay/edit/master/docs/Modern-GraphQLInRelay.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">GraphQL in Relay</h1></header><article><div><span><p>Table of Contents:</p>
<ul>
<li><a href="#graphql"><code>graphql</code></a></li>
<li><a href="#directives">Directives</a></li>
<li><a href="#relay-compiler">Relay Compiler</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="graphql"></a><a href="#graphql" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>graphql</code></h2>
<p>The <code>graphql</code> template tag provided by Relay serves as the mechanism to write queries, fragments, mutations or subscriptions in the <a href="http://graphql.org/learn/">GraphQL</a> language. For example:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">import</span> {graphql} <span class="hljs-keyword">from</span> <span class="hljs-string">'react-relay'</span>;

graphql<span class="hljs-string">`
  query MyQuery {
    viewer {
      id
    }
  }
`</span>;
</code></pre>
<p>The result of using the <code>graphql</code> template tag is a <code>GraphQLTaggedNode</code>; a runtime representation of the GraphQL document which can be used to define <a href="./query-renderer">Query Renderers</a>, <a href="./fragment-container">Fragment Containers</a>, <a href="./refetch-container">Refetch Containers</a>, <a href="./pagination-container">Pagination Containers</a>, etc.</p>
<p>Note that <code>graphql</code> template tags are <strong>never executed at runtime</strong>. Instead, they are compiled ahead of time by the <a href="#relay-compiler">Relay Compiler</a> into generated artifacts that live alongside your source code, and which Relay requires to operate at runtime. The <a href="./installation-and-setup.html#setup-babel-plugin-relay">Relay Babel plugin</a> will then convert the <code>graphql</code> literals in your code into <code>require()</code> calls for the generated files.</p>
<h2><a class="anchor" aria-hidden="true" id="directives"></a><a href="#directives" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Directives</h2>
<p>Relay uses directives to add additional information to GraphQL documents, which are used by the <a href="#relay-compiler">Relay Compiler</a> to generate the appropriate runtime artifacts. These directives only appear in your application code and are removed from requests sent to your GraphQL server.</p>
<p><strong>Note:</strong> The relay-compiler will maintain any directives supported by your server (such as <code>@include</code> or <code>@skip</code>) so they remain part of the request to the GraphQL server and won't alter generated runtime artifacts.</p>
<h3><a class="anchor" aria-hidden="true" id="arguments"></a><a href="#arguments" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>@arguments</code></h3>
<p><code>@arguments</code> is a directive used to pass arguments to a fragment that was defined using <a href="#argumentdefinitions"><code>@argumentDefinitions</code></a>. For example:</p>
<pre><code class="hljs css language-graphql">query TodoListQuery($userID: ID) {
  ...TodoList_list <span class="hljs-symbol">@arguments</span>(count: $count, userID: $userID) <span class="hljs-meta"># Pass arguments here</span>
}
</code></pre>
<p>See the <a href="./fragment-container.html#passing-arguments-to-a-fragment">Fragment Container docs</a> for more details.</p>
<h3><a class="anchor" aria-hidden="true" id="argumentdefinitions"></a><a href="#argumentdefinitions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>@argumentDefinitions</code></h3>
<p><code>@argumentDefinitions</code> is a directive used to specify arguments taken by a fragment. For example:</p>
<pre><code class="hljs css language-graphql"><span class="hljs-keyword">fragment</span> TodoList_list <span class="hljs-keyword">on</span> TodoList @argumentDefinitions(
  count: {type: <span class="hljs-string">"Int"</span>, <span class="hljs-keyword">default</span>Value: <span class="hljs-number">10</span>},  <span class="hljs-comment"># Optional argument</span>
  <span class="hljs-keyword">user</span>ID: {type: <span class="hljs-string">"ID"</span>},                    <span class="hljs-comment"># Required argument</span>
) {
  title
  todoItems(<span class="hljs-keyword">user</span>ID: <span class="hljs-variable">$userID</span>, first: <span class="hljs-variable">$count</span>) {  <span class="hljs-comment"># Use fragment arguments here as variables</span>
    ...TodoItem_item
  }
}
</code></pre>
<p>See the <a href="./fragment-container.html#passing-arguments-to-a-fragment">Fragment Container docs</a> for more details.</p>
<h3><a class="anchor" aria-hidden="true" id="connectionkey-string-filters-string"></a><a href="#connectionkey-string-filters-string" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>@connection(key: String!, filters: [String])</code></h3>
<p>When using the <a href="./pagination-container.html">Pagination Container</a>, Relay expects connection fields to be annotated with a <code>@connection</code> directive. For more detailed information and an example, check out the <a href="./pagination-container.html#connection">docs on using <code>@connection</code> inside a Pagination Container</a>.</p>
<p><strong>Note:</strong> <code>@connection</code> is also supported in <a href="./relay-compat.html">compatibility mode</a></p>
<h3><a class="anchor" aria-hidden="true" id="relayplural-boolean"></a><a href="#relayplural-boolean" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>@relay(plural: Boolean)</code></h3>
<p>When defining a fragment for use with a Fragment container, you can use the <code>@relay(plural: true)</code> directive to indicate that container expects the prop for that fragment to be a list of items instead of a single item. A query or parent that spreads a <code>@relay(plural: true)</code> fragment should do so within a plural field (ie a field backed by a <a href="http://graphql.org/learn/schema/#lists-and-non-null">GraphQL list</a>. For example:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-comment">// Plural fragment definition</span>
graphql<span class="hljs-string">`
fragment TodoItems_items on TodoItem @relay(plural: true) {
  id
  text
}`</span>;

<span class="hljs-comment">// Plural fragment usage: note the parent type is a list of items (`[TodoItem}]`)</span>
fragment TodoApp_app on App {
  items {
    <span class="hljs-comment">// parent type is a list here</span>
    ...TodoItem_items
  }
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="relaymask-boolean"></a><a href="#relaymask-boolean" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>@relay(mask: Boolean)</code></h3>
<p>By default Relay will only expose the data for fields explicitly requested by a <a href="./fragment-container.html#createfragmentcontainer">component's fragment</a>, which is known as <a href="./thinking-in-relay#data-masking">data masking</a>.</p>
<p>However, <code>@relay(mask: false)</code> can be used to prevent data masking; when including a fragment and annotating it with <code>@relay(mask: false)</code>, its data will be available directly to the parent instead of being masked for a different container.</p>
<p>Applied to a fragment definition, <code>@relay(mask: false)</code> changes the generated Flow types to be better usable when the fragment is included with the same directive. The Flow types will no longer be exact objects and no longer contain internal marker fields.</p>
<p>This may be helpful to reduce redundant fragments when dealing with nested or recursive data within a single Component.</p>
<p>Keep in mind that it is typically considered an <strong>anti-pattern</strong> to create a single fragment shared across many containers. Abusing this directive could result in over-fetching in your application.</p>
<p>In the example below, the <code>user</code> prop will include the data for <code>id</code> and <code>name</code> fields wherever <code>...Component_internUser</code> is included, instead of Relay's normal behavior to mask those fields:</p>
<pre><code class="hljs css language-javascript">graphql<span class="hljs-string">`
  fragment Component_internUser on InternUser @relay(mask: false) {
    id
    name
  }
`</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> createFragmentContainer(
  <span class="hljs-function">(<span class="hljs-params">{ user }</span>) =&gt;</span> <span class="hljs-comment">/* ... */</span>,
  graphql<span class="hljs-string">`
    fragment Component_user on User {
      internUser {
        manager {
          ...Component_internUser @relay(mask: false)
        }
        ... on Employee {
          admins {
            ...Component_internUser @relay(mask: false)
          }
          reports {
            ...Component_internUser @relay(mask: false)
          }
        }
      }
    }
  `</span>,
);
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="relay-compiler"></a><a href="#relay-compiler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Relay Compiler</h2>
<p>Relay uses the Relay Compiler to convert <a href="#graphql"><code>graphql</code></a> literals into generated files that live alongside your source files.</p>
<p>A query like the following:</p>
<pre><code class="hljs css language-javascript">graphql<span class="hljs-string">`
  fragment MyComponent on Type {
    field
  }
`</span>
</code></pre>
<p>Will cause a generated file to appear in <code>./__generated__/MyComponent.graphql</code>,
with both runtime artifacts (which help to read and write from the Relay Store)
and <a href="https://flow.org/">Flow types</a> to help you write type-safe code.</p>
<p>The Relay Compiler is responsible for generating code as part of a build step which can then be referenced at runtime. By building the query ahead of time, the Relay's runtime is not responsible for generating a query string, and various optimizations can be performed on the query that could be too expensive at runtime (for example, fields that are duplicated in the query can be merged during the build step, to improve efficiency of processing the GraphQL response).</p>
<h3><a class="anchor" aria-hidden="true" id="persisting-queries"></a><a href="#persisting-queries" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Persisting queries</h3>
<p>Relay Compiler supports the use of <strong>persisted queries</strong>, in which each version of a query is associated to a unique ID on the server and the runtime uploads only the persisted ID instead of the full query text. This has several benefits: it can significantly reduce the time to send a query (and the upload bytes) and enables <em>whitelisting</em> of queries. For example, you may choose to disallow queries in text form and only allow queries that have been persisted (and that presumably have passed your internal code review process).</p>
<p>Persisted queries can be enabled by instructing Relay Compiler to emit metadata about each query, mutation, and subscription into a JSON file. The generated file will contain a mapping of query identifiers to query text, which you can then save to your server. To enable persisted queries, use the <code>--persist-output</code> flag to the compiler:</p>
<pre><code class="hljs css language-js"><span class="hljs-string">"scripts"</span>: {
  <span class="hljs-string">"relay"</span>: <span class="hljs-string">"relay-compiler --src ./src --schema ./schema.graphql --persist-output ./path/to/persisted-queries.json"</span>
}
</code></pre>
<p>Relay Compiler will then create the id =&gt; query text mapping in the path you specify. You can then use this complete
json file in your server side to map query ids to operation text.</p>
<p>For more details, refer to the <a href="./persisted-queries.html">Persisted Queries section</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="set-up-relay-compiler"></a><a href="#set-up-relay-compiler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Set up relay-compiler</h3>
<p>See our relay-compiler section in our <a href="./installation-and-setup.html#set-up-relay-compiler">Installation and Setup guide</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="graphql-schema"></a><a href="#graphql-schema" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GraphQL Schema</h3>
<p>To use the Relay Compiler, you need either a .graphql or .json GraphQL schema file, describing your GraphQL server's API. Typically these files are local representations of a server source of truth and are not edited directly. For example, we might have a <code>schema.graphql</code> like:</p>
<pre><code class="hljs css language-graphql">schema {
  query: Root
}
<span class="hljs-built_in">
type </span>Root {
  dictionary: [Word]
}
<span class="hljs-built_in">
type </span>Word {
  id: String!
  definition: WordDefinition
}
<span class="hljs-built_in">
type </span>WordDefinition {
  text: String
  image: String
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="source-files"></a><a href="#source-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Source files</h3>
<p>Additionally, you need a directory containing <code>.js</code> files that use the <code>graphql</code> tag to describe GraphQL queries and fragments. Let's call this <code>./src</code>.</p>
<p>Then run <code>yarn run relay</code> as set up before.</p>
<p>This will create a series of <code>__generated__</code> directories that are co-located with the corresponding files containing <code>graphql</code> tags.</p>
<p>For example, given the two files:</p>
<ul>
<li><p><code>src/Components/DictionaryComponent.js</code></p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">const</span> DictionaryWordFragment = graphql<span class="hljs-string">`
  fragment DictionaryComponent_word on Word {
    id
    definition {
      ...DictionaryComponent_definition
    }
  }
`</span>

<span class="hljs-keyword">const</span> DictionaryDefinitionFragment = graphql<span class="hljs-string">`
  fragment DictionaryComponent_definition on WordDefinition {
    text
    image
  }
`</span>
</code></pre></li>
<li><p><code>src/Queries/DictionaryQuery.js</code></p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">const</span> DictionaryQuery = graphql<span class="hljs-string">`
  query DictionaryQuery {
    dictionary {
      ...DictionaryComponent_word
    }
  }
`</span>
</code></pre></li>
</ul>
<p>This would produce three generated files, and two <code>__generated__</code> directories:</p>
<ul>
<li><code>src/Components/__generated__/DictionaryComponent_word.graphql.js</code></li>
<li><code>src/Components/__generated__/DictionaryComponent_definition.graphql.js</code></li>
<li><code>src/Queries/__generated__/DictionaryQuery.graphql.js</code></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="importing-generated-definitions"></a><a href="#importing-generated-definitions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Importing generated definitions</h3>
<p>Typically you will not need to import your generated definitions. The <a href="./installation-and-setup.html#setup-babel-plugin-relay">Relay Babel plugin</a> will then convert the <code>graphql</code> literals in your code into <code>require()</code> calls for the generated files.</p>
<p>However the Relay Compiler also automatically generates <a href="https://flow.org">Flow</a> types as <a href="https://flow.org/en/docs/types/comments/">type comments</a>. For example, you can import the generated Flow types like so:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">import</span> type {DictionaryComponent_word} <span class="hljs-keyword">from</span> <span class="hljs-string">'./__generated__/DictionaryComponent_word.graphql'</span>;
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="advanced-usage"></a><a href="#advanced-usage" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Advanced usage</h3>
<p>In addition to the bin script, the <code>relay-compiler</code> package also <a href="https://github.com/facebook/relay/blob/master/packages/relay-compiler/RelayCompilerPublic.js">exports library code</a> which you may use to create more complex configurations for the compiler, or to extend the compiler with your own custom output.</p>
<p>If you find you need to do something unique (like generate types that conform to an older version of Flow, or to parse non-javascript source files), you can build your own version of the Compiler by swapping in your own <code>FileWriter</code> and <code>ASTCache</code>, or by adding on an additional <code>IRTransform</code>. Note, the internal APIs of the <code>RelayCompiler</code> are under constant iteration, so rolling your own version may lead to incompatibilities with future releases.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/relay/docs/en/quick-start-guide.html"><span class="arrow-prev">← </span><span>Quick Start Guide</span></a><a class="docs-next button" href="/relay/docs/en/relay-environment.html"><span>Relay Environment</span><span class="arrow-next"> →</span></a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/relay/" class="nav-home"><img src="/relay/img/relay.svg" alt="Relay" width="66" height="58"/></a><div><h5>Docs</h5><a href="/relay/docs/en/introduction-to-relay.html">Introduction</a></div><div><h5>Community</h5><a href="/relay/en/users.html">User Showcase</a></div><div><h5>More</h5><a href="https://github.com/facebook/relay">GitHub</a><a class="github-button" href="https://github.com/facebook/relay" data-icon="octicon-star" data-count-href="/facebook/relay/stargazers" data-count-api="/repos/facebook/relay#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/relay/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 Facebook Inc.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '3d7d5825d50ea36bca0e6ad06c926f06',
                indexName: 'relay',
                inputSelector: '#search_input_react'
              });
            </script></body></html>